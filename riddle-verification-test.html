<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riddle Verification Test - Cerebray</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
        }

        .test-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .success {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }

        .warning {
            border-color: #FF9800;
            background: rgba(255, 152, 0, 0.2);
        }

        .error {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.2);
        }

        .riddle-sample {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }

        .show-answer-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .answer-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            display: none;
        }

        .cache-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9em;
        }

        .clear-cache-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }

        .refresh-btn {
            background: #2ed573;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🧩 Riddle Verification Test</h1>
            <p>Comprehensive test to verify riddles are being generated with show answer buttons and fresh content is created daily</p>
            <button onclick="clearAllCache()" class="clear-cache-btn">Clear All Cache</button>
            <button onclick="runTests()" class="refresh-btn">Run Tests</button>
        </div>

        <div class="test-section">
            <h2>📊 Test Results</h2>
            <div id="testResults" class="test-results">
                <!-- Test results will be populated here -->
            </div>
        </div>

        <div class="test-section">
            <h2>🧩 Sample Riddles with Show Answer Buttons</h2>
            <div id="riddleSamples">
                <!-- Riddle samples will be populated here -->
            </div>
        </div>

        <div class="test-section">
            <h2>💾 Cache Information</h2>
            <div id="cacheInfo" class="cache-info">
                <!-- Cache info will be populated here -->
            </div>
        </div>

        <div class="test-section">
            <h2>📈 Content Pool Statistics</h2>
            <div id="contentStats" class="cache-info">
                <!-- Content stats will be populated here -->
            </div>
        </div>
    </div>

    <!-- Include required scripts -->
    <script src="premium-content-backend.js"></script>
    <script src="script.js"></script>

    <script>
        let premiumBackend = null;
        let testResults = [];

        async function initializeTest() {
            try {
                premiumBackend = new PremiumContentBackend();
                await premiumBackend.initialize();
                await runTests();
            } catch (error) {
                console.error('Error initializing test:', error);
                addTestResult('Initialization', false, `Failed to initialize: ${error.message}`);
            }
        }

        async function runTests() {
            testResults = [];
            
            // Test 1: Check if riddles are available
            await testRiddleAvailability();
            
            // Test 2: Check if daily cards include riddles
            await testDailyCardsIncludeRiddles();
            
            // Test 3: Check if riddles have show answer buttons
            await testRiddleShowAnswerButtons();
            
            // Test 4: Check cache freshness
            await testCacheFreshness();
            
            // Test 5: Check content pool stats
            await testContentPoolStats();
            
            // Display results
            displayTestResults();
            displayCacheInfo();
            displayContentStats();
            displayRiddleSamples();
        }

        async function testRiddleAvailability() {
            try {
                const contentStats = premiumBackend.getContentPoolStats();
                const riddleCount = contentStats.riddles;
                
                if (riddleCount > 0) {
                    addTestResult('Riddle Availability', true, `${riddleCount} riddles available in content pool`);
                } else {
                    addTestResult('Riddle Availability', false, 'No riddles found in content pool');
                }
            } catch (error) {
                addTestResult('Riddle Availability', false, `Error checking riddles: ${error.message}`);
            }
        }

        async function testDailyCardsIncludeRiddles() {
            try {
                const todaysCards = premiumBackend.getTodaysCards();
                const riddleCards = todaysCards.filter(card => card.type === 'Riddle' || card.category === 'Brain Teaser');
                
                if (riddleCards.length > 0) {
                    addTestResult('Daily Cards Include Riddles', true, `${riddleCards.length} riddle cards found in today's ${todaysCards.length} cards`);
                } else {
                    addTestResult('Daily Cards Include Riddles', false, `No riddle cards found in today's ${todaysCards.length} cards`);
                }
            } catch (error) {
                addTestResult('Daily Cards Include Riddles', false, `Error checking daily cards: ${error.message}`);
            }
        }

        async function testRiddleShowAnswerButtons() {
            try {
                const todaysCards = premiumBackend.getTodaysCards();
                const riddleCards = todaysCards.filter(card => card.type === 'Riddle' || card.category === 'Brain Teaser');
                
                let correctButtons = 0;
                let totalRiddles = riddleCards.length;
                
                riddleCards.forEach(card => {
                    if (card.action === 'Show Answer' && (card.solution || card.answer)) {
                        correctButtons++;
                    }
                });
                
                if (totalRiddles > 0 && correctButtons === totalRiddles) {
                    addTestResult('Riddle Show Answer Buttons', true, `All ${totalRiddles} riddles have correct show answer buttons`);
                } else if (totalRiddles > 0) {
                    addTestResult('Riddle Show Answer Buttons', false, `Only ${correctButtons}/${totalRiddles} riddles have correct show answer buttons`);
                } else {
                    addTestResult('Riddle Show Answer Buttons', false, 'No riddles to test');
                }
            } catch (error) {
                addTestResult('Riddle Show Answer Buttons', false, `Error checking show answer buttons: ${error.message}`);
            }
        }

        async function testCacheFreshness() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const cacheKey = `boredom_buster_premium_daily_cards_${today}`;
                const cachedCards = localStorage.getItem(cacheKey);
                
                if (cachedCards) {
                    const cards = JSON.parse(cachedCards);
                    addTestResult('Cache Freshness', true, `Today's cache exists with ${cards.length} cards`);
                } else {
                    addTestResult('Cache Freshness', false, 'No cache found for today - will generate fresh content');
                }
            } catch (error) {
                addTestResult('Cache Freshness', false, `Error checking cache: ${error.message}`);
            }
        }

        async function testContentPoolStats() {
            try {
                const stats = premiumBackend.getContentPoolStats();
                const totalContent = stats.riddles + stats.mathChallenges + stats.premiumGames;
                
                Object.keys(stats.funFacts).forEach(category => {
                    totalContent += stats.funFacts[category];
                });
                
                Object.keys(stats.activities).forEach(category => {
                    totalContent += stats.activities[category];
                });
                
                if (totalContent > 100) {
                    addTestResult('Content Pool Size', true, `${totalContent} total pieces of content available`);
                } else {
                    addTestResult('Content Pool Size', false, `Only ${totalContent} pieces of content available (need more for variety)`);
                }
            } catch (error) {
                addTestResult('Content Pool Size', false, `Error checking content pool: ${error.message}`);
            }
        }

        function addTestResult(testName, passed, message) {
            testResults.push({
                name: testName,
                passed: passed,
                message: message
            });
        }

        function displayTestResults() {
            const container = document.getElementById('testResults');
            container.innerHTML = '';
            
            testResults.forEach(result => {
                const resultCard = document.createElement('div');
                resultCard.className = `result-card ${result.passed ? 'success' : 'error'}`;
                resultCard.innerHTML = `
                    <h3>${result.passed ? '✅' : '❌'} ${result.name}</h3>
                    <p>${result.message}</p>
                `;
                container.appendChild(resultCard);
            });
        }

        function displayCacheInfo() {
            const container = document.getElementById('cacheInfo');
            const today = new Date().toISOString().split('T')[0];
            const cacheKey = `boredom_buster_premium_daily_cards_${today}`;
            
            let cacheInfo = `Today's Date: ${today}\n`;
            cacheInfo += `Cache Key: ${cacheKey}\n`;
            
            const cachedCards = localStorage.getItem(cacheKey);
            if (cachedCards) {
                const cards = JSON.parse(cachedCards);
                cacheInfo += `Cache Status: EXISTS (${cards.length} cards)\n`;
                cacheInfo += `Cache Size: ${(JSON.stringify(cards).length / 1024).toFixed(2)} KB\n`;
                
                const riddleCards = cards.filter(card => card.type === 'Riddle' || card.category === 'Brain Teaser');
                cacheInfo += `Riddles in Cache: ${riddleCards.length}\n`;
            } else {
                cacheInfo += `Cache Status: NOT FOUND\n`;
            }
            
            // Check for old cache entries
            const allKeys = Object.keys(localStorage);
            const cacheKeys = allKeys.filter(key => key.includes('daily_cards_'));
            cacheInfo += `\nOther Cache Entries: ${cacheKeys.length}\n`;
            cacheKeys.forEach(key => {
                cacheInfo += `  - ${key}\n`;
            });
            
            container.textContent = cacheInfo;
        }

        function displayContentStats() {
            const container = document.getElementById('contentStats');
            const stats = premiumBackend.getContentPoolStats();
            
            let statsText = 'Content Pool Statistics:\n\n';
            statsText += `Riddles: ${stats.riddles}\n`;
            statsText += `Math Challenges: ${stats.mathChallenges}\n`;
            statsText += `Premium Games: ${stats.premiumGames}\n\n`;
            
            statsText += 'Fun Facts by Category:\n';
            Object.keys(stats.funFacts).forEach(category => {
                statsText += `  - ${category}: ${stats.funFacts[category]}\n`;
            });
            
            statsText += '\nActivities by Category:\n';
            Object.keys(stats.activities).forEach(category => {
                statsText += `  - ${category}: ${stats.activities[category]}\n`;
            });
            
            container.textContent = statsText;
        }

        function displayRiddleSamples() {
            const container = document.getElementById('riddleSamples');
            const todaysCards = premiumBackend.getTodaysCards();
            const riddleCards = todaysCards.filter(card => card.type === 'Riddle' || card.category === 'Brain Teaser');
            
            container.innerHTML = '';
            
            if (riddleCards.length === 0) {
                container.innerHTML = '<p>❌ No riddles found in today\'s cards!</p>';
                return;
            }
            
            // Show first 3 riddles as samples
            riddleCards.slice(0, 3).forEach((riddle, index) => {
                const riddleDiv = document.createElement('div');
                riddleDiv.className = 'riddle-sample';
                riddleDiv.innerHTML = `
                    <h4>Sample Riddle ${index + 1}</h4>
                    <p><strong>Question:</strong> ${riddle.description}</p>
                    <button class="show-answer-btn" onclick="showAnswer(${index})">
                        ${riddle.action || 'Show Answer'}
                    </button>
                    <div id="answer-${index}" class="answer-display">
                        <strong>Answer:</strong> ${riddle.solution || riddle.answer || 'No answer provided'}
                    </div>
                `;
                container.appendChild(riddleDiv);
            });
            
            const summary = document.createElement('div');
            summary.innerHTML = `<p><strong>Total riddles in today's cards: ${riddleCards.length}</strong></p>`;
            container.appendChild(summary);
        }

        function showAnswer(index) {
            const answerDiv = document.getElementById(`answer-${index}`);
            answerDiv.style.display = answerDiv.style.display === 'none' ? 'block' : 'block';
        }

        function clearAllCache() {
            const keys = Object.keys(localStorage);
            const cacheKeys = keys.filter(key => key.includes('boredom_buster') || key.includes('daily_cards'));
            
            cacheKeys.forEach(key => {
                localStorage.removeItem(key);
            });
            
            alert(`Cleared ${cacheKeys.length} cache entries. Refreshing page...`);
            location.reload();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeTest);
    </script>
</body>
</html>
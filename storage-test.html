<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storage Test - Comment System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>üîß Comment Storage System Test</h1>
    
    <div class="test-section">
        <h2>Current Storage Status</h2>
        <button onclick="checkStorage()">Check All Storage Keys</button>
        <div id="storageOutput" class="output"></div>
    </div>
    
    <div class="test-section">
        <h2>Force Add Sample Comments</h2>
        <button onclick="addSampleComments()">Add Sample Comments to Post 1</button>
        <button onclick="clearAllComments()">Clear All Comments</button>
        <div id="sampleOutput" class="output"></div>
    </div>
    
    <div class="test-section">
        <h2>Test Article Links</h2>
        <a href="post-1.html" target="_blank">Open Post 1</a> |
        <a href="post-2.html" target="_blank">Open Post 2</a> |
        <a href="post-3.html" target="_blank">Open Post 3</a>
    </div>

    <script>
        function checkStorage() {
            const output = document.getElementById('storageOutput');
            let result = '=== STORAGE ANALYSIS ===\n\n';
            
            // Check all localStorage keys
            const allKeys = Object.keys(localStorage);
            result += `Total localStorage keys: ${allKeys.length}\n\n`;
            
            // Check for comment-related keys
            const commentKeys = allKeys.filter(key => key.includes('comment'));
            result += `Comment-related keys: ${commentKeys.length}\n`;
            commentKeys.forEach(key => {
                const value = localStorage.getItem(key);
                try {
                    const parsed = JSON.parse(value);
                    result += `\nüìù ${key}:\n`;
                    if (Array.isArray(parsed)) {
                        result += `   Type: Array with ${parsed.length} items\n`;
                        parsed.forEach((item, index) => {
                            result += `   [${index}] ${item.author}: "${item.content.substring(0, 50)}..."\n`;
                        });
                    } else {
                        result += `   Type: Object with keys: ${Object.keys(parsed).join(', ')}\n`;
                    }
                } catch (e) {
                    result += `\nüìù ${key}: ${value.substring(0, 100)}...\n`;
                }
            });
            
            // Check specific post keys
            result += '\n=== POST-SPECIFIC KEYS ===\n';
            for (let i = 1; i <= 5; i++) {
                const key = `blog_comments_${i}`;
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const comments = JSON.parse(value);
                        result += `\n‚úÖ ${key}: ${comments.length} comments\n`;
                        comments.forEach((comment, index) => {
                            result += `   [${index}] ${comment.author}: "${comment.content.substring(0, 40)}..."\n`;
                        });
                    } catch (e) {
                        result += `\n‚ùå ${key}: Invalid JSON\n`;
                    }
                } else {
                    result += `\n‚ö™ ${key}: No data\n`;
                }
            }
            
            output.textContent = result;
        }
        
        function addSampleComments() {
            const output = document.getElementById('sampleOutput');
            
            // Clear existing and add fresh sample comments
            localStorage.removeItem('blog_comments_1');
            
            const sampleComments = [
                {
                    id: Date.now().toString(),
                    content: "These are fantastic ideas! I especially love the VR gaming suggestion. Can't wait to try some of these activities.",
                    author: "Sarah Johnson",
                    userId: "sample_user_1",
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    isAuthenticated: true
                },
                {
                    id: (Date.now() + 1).toString(),
                    content: "The indoor gardening tip is perfect timing! I've been wanting to start growing herbs in my apartment.",
                    author: "Mike Chen",
                    userId: "sample_user_2",
                    timestamp: new Date(Date.now() - 7200000).toISOString(),
                    isAuthenticated: false
                },
                {
                    id: (Date.now() + 2).toString(),
                    content: "Great article! The escape room challenge sounds like so much fun. Going to try this with my family this weekend.",
                    author: "Anonymous Reader",
                    userId: "sample_user_3",
                    timestamp: new Date(Date.now() - 10800000).toISOString(),
                    isAuthenticated: false
                }
            ];
            
            localStorage.setItem('blog_comments_1', JSON.stringify(sampleComments));
            
            output.innerHTML = `<span class="success">‚úÖ Added ${sampleComments.length} sample comments to blog_comments_1</span>\n\n`;
            output.innerHTML += sampleComments.map((comment, index) => 
                `[${index}] ${comment.author}: "${comment.content.substring(0, 50)}..."`
            ).join('\n');
            
            // Also check storage after adding
            setTimeout(checkStorage, 100);
        }
        
        function clearAllComments() {
            const output = document.getElementById('sampleOutput');
            
            // Clear all comment-related keys
            const allKeys = Object.keys(localStorage);
            const commentKeys = allKeys.filter(key => key.includes('comment'));
            
            commentKeys.forEach(key => localStorage.removeItem(key));
            
            output.innerHTML = `<span class="info">üóëÔ∏è Cleared ${commentKeys.length} comment-related keys:</span>\n${commentKeys.join('\n')}`;
            
            // Also check storage after clearing
            setTimeout(checkStorage, 100);
        }
        
        // Auto-check storage on page load
        window.addEventListener('load', checkStorage);
    </script>
</body>
</html>
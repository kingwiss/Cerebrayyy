<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Premium Features Test - Cerebray</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="premium-games.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .test-header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .test-section {
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .test-section h2 {
            color: #ffd700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .test-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .test-card h4 {
            color: #ffd700;
            margin-bottom: 15px;
        }

        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }

        .test-result.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .test-result.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid rgba(244, 67, 54, 0.5);
        }

        .test-result.info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid rgba(33, 150, 243, 0.5);
        }

        .test-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .test-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .test-btn.primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            color: #333;
        }

        .test-btn.primary:hover {
            background: linear-gradient(135deg, #ffb347 0%, #ffd700 100%);
        }

        .games-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .game-preview {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-preview:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .game-preview i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .navigation-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .test-header h1 {
                font-size: 2rem;
            }
            
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .games-preview {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1><i class="fas fa-crown"></i> Premium Features Test Suite</h1>
            <p>Comprehensive testing of the premium content system with 100 daily cards and exclusive games</p>
        </div>

        <!-- System Status -->
        <div class="test-section">
            <h2><i class="fas fa-cogs"></i> System Status</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>Premium Backend Status</h4>
                    <div id="premiumBackendStatus" class="test-result info">Checking...</div>
                    <button class="test-btn" onclick="checkPremiumBackend()">Check Backend</button>
                </div>
                <div class="test-card">
                    <h4>Content Pool Status</h4>
                    <div id="contentPoolStatus" class="test-result info">Checking...</div>
                    <button class="test-btn" onclick="checkContentPools()">Check Pools</button>
                </div>
            </div>
        </div>

        <!-- Premium Content Testing -->
        <div class="test-section">
            <h2><i class="fas fa-layer-group"></i> Premium Content Testing</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>Daily Cards Generation</h4>
                    <div id="dailyCardsStatus" class="test-result info">Ready to test</div>
                    <button class="test-btn primary" onclick="testDailyCardsGeneration()">Generate 100 Cards</button>
                    <button class="test-btn" onclick="showCardsSample()">Show Sample</button>
                </div>
                <div class="test-card">
                    <h4>New Content Ratio</h4>
                    <div id="newContentRatio" class="test-result info">Not tested</div>
                    <button class="test-btn" onclick="testNewContentRatio()">Test 90% Ratio</button>
                </div>
            </div>
        </div>

        <!-- Premium Games Testing -->
        <div class="test-section">
            <h2><i class="fas fa-gamepad"></i> Premium Games Testing</h2>
            <div class="games-preview">
                <div class="game-preview" onclick="testPremiumGame('sudoku')">
                    <i class="fas fa-th"></i>
                    <div>Sudoku</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('crossword')">
                    <i class="fas fa-font"></i>
                    <div>Crossword</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('pacman')">
                    <i class="fas fa-ghost"></i>
                    <div>Pac-Man</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('tetris')">
                    <i class="fas fa-cubes"></i>
                    <div>Tetris</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('galaga')">
                    <i class="fas fa-rocket"></i>
                    <div>Galaga</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('snake')">
                    <i class="fas fa-snake"></i>
                    <div>Snake</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('breakout')">
                    <i class="fas fa-circle"></i>
                    <div>Breakout</div>
                </div>
                <div class="game-preview" onclick="testPremiumGame('memory')">
                    <i class="fas fa-gamepad"></i>
                    <div>Memory Match</div>
                </div>
            </div>
            <div id="gameTestResults" class="test-result info" style="margin-top: 20px;">Click a game to test</div>
        </div>

        <!-- User Progress Testing -->
        <div class="test-section">
            <h2><i class="fas fa-chart-line"></i> User Progress & Statistics</h2>
            <div class="stats-display" id="userStatsDisplay">
                <div class="stat-item">
                    <div class="stat-value" id="cardsViewedToday">0</div>
                    <div class="stat-label">Cards Viewed Today</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCardsViewed">0</div>
                    <div class="stat-label">Total Cards Viewed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="daysActive">0</div>
                    <div class="stat-label">Days Active</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="newContentPercentage">90%</div>
                    <div class="stat-label">New Content Available</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button class="test-btn" onclick="simulateCardViewing()">Simulate Card Viewing</button>
                <button class="test-btn" onclick="resetUserProgress()">Reset Progress</button>
                <button class="test-btn" onclick="loadUserStats()">Refresh Stats</button>
            </div>
        </div>

        <!-- Performance Testing -->
        <div class="test-section">
            <h2><i class="fas fa-tachometer-alt"></i> Performance Testing</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>Generation Speed</h4>
                    <div id="generationSpeed" class="test-result info">Not tested</div>
                    <button class="test-btn" onclick="testGenerationSpeed()">Test Speed</button>
                </div>
                <div class="test-card">
                    <h4>Memory Usage</h4>
                    <div id="memoryUsage" class="test-result info">Not tested</div>
                    <button class="test-btn" onclick="testMemoryUsage()">Check Memory</button>
                </div>
            </div>
        </div>

        <div class="navigation-links">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i> Main App
            </a>
            <a href="daily-content-test.html" class="nav-btn">
                <i class="fas fa-vial"></i> Daily Content Test
            </a>
            <button onclick="runAllTests()" class="nav-btn" style="background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%); color: #333;">
                <i class="fas fa-play"></i> Run All Tests
            </button>
        </div>
    </div>

    <!-- Premium Content System -->
    <script src="premium-content-backend.js"></script>
    <script src="premium-games.js"></script>

    <script>
        let premiumBackend = null;
        let testResults = {};

        // Initialize test suite
        async function initializeTestSuite() {
            try {
                console.log('Initializing premium test suite...');
                
                // Initialize Premium Content Backend
                premiumBackend = new PremiumContentBackend();
                
                // Load initial stats
                await loadUserStats();
                
                // Check system status
                await checkPremiumBackend();
                await checkContentPools();
                
                console.log('Premium test suite initialized successfully');
            } catch (error) {
                console.error('Error initializing test suite:', error);
                showResult('premiumBackendStatus', 'Error: ' + error.message, 'error');
            }
        }

        // Check premium backend status
        async function checkPremiumBackend() {
            try {
                if (!premiumBackend) {
                    premiumBackend = new PremiumContentBackend();
                }
                
                const stats = premiumBackend.getContentPoolStats();
                showResult('premiumBackendStatus', `✅ Backend active - ${stats.totalCards} total cards available`, 'success');
                testResults.backend = true;
            } catch (error) {
                showResult('premiumBackendStatus', `❌ Backend error: ${error.message}`, 'error');
                testResults.backend = false;
            }
        }

        // Check content pools
        async function checkContentPools() {
            try {
                if (!premiumBackend) {
                    throw new Error('Premium backend not initialized');
                }
                
                const stats = premiumBackend.getContentPoolStats();
                const poolInfo = `Fun Facts: ${stats.funFacts}, Activities: ${stats.activities}, Riddles: ${stats.riddles}, Math: ${stats.mathChallenges}, Games: ${stats.games}`;
                showResult('contentPoolStatus', `✅ All pools loaded - ${poolInfo}`, 'success');
                testResults.contentPools = true;
            } catch (error) {
                showResult('contentPoolStatus', `❌ Pool error: ${error.message}`, 'error');
                testResults.contentPools = false;
            }
        }

        // Test daily cards generation
        async function testDailyCardsGeneration() {
            try {
                showResult('dailyCardsStatus', '⏳ Generating 100 premium cards...', 'info');
                
                const startTime = performance.now();
                const cards = await premiumBackend.getTodaysPremiumCards();
                const endTime = performance.now();
                
                const generationTime = Math.round(endTime - startTime);
                
                if (cards.length === 100) {
                    showResult('dailyCardsStatus', `✅ Generated ${cards.length} cards in ${generationTime}ms`, 'success');
                    testResults.cardGeneration = true;
                } else {
                    showResult('dailyCardsStatus', `⚠️ Generated ${cards.length} cards (expected 100) in ${generationTime}ms`, 'error');
                    testResults.cardGeneration = false;
                }
            } catch (error) {
                showResult('dailyCardsStatus', `❌ Generation failed: ${error.message}`, 'error');
                testResults.cardGeneration = false;
            }
        }

        // Show sample cards
        async function showCardsSample() {
            try {
                const cards = await premiumBackend.getTodaysPremiumCards();
                const sample = cards.slice(0, 5);
                
                let sampleText = 'Sample cards:\n';
                sample.forEach((card, index) => {
                    sampleText += `${index + 1}. ${card.type}: ${card.title}\n`;
                });
                
                alert(sampleText);
            } catch (error) {
                alert('Error getting sample: ' + error.message);
            }
        }

        // Test new content ratio
        async function testNewContentRatio() {
            try {
                const userStats = premiumBackend.getUserStats();
                const contentStats = premiumBackend.getContentPoolStats();
                
                const totalCards = contentStats.totalCards;
                const viewedCards = userStats.totalCardsViewed || 0;
                const newContentRatio = Math.max(0, Math.min(100, Math.round((1 - viewedCards / totalCards) * 100)));
                
                if (newContentRatio >= 90) {
                    showResult('newContentRatio', `✅ ${newContentRatio}% new content available (≥90% target met)`, 'success');
                    testResults.newContentRatio = true;
                } else {
                    showResult('newContentRatio', `⚠️ ${newContentRatio}% new content available (<90% target)`, 'error');
                    testResults.newContentRatio = false;
                }
            } catch (error) {
                showResult('newContentRatio', `❌ Test failed: ${error.message}`, 'error');
                testResults.newContentRatio = false;
            }
        }

        // Test premium game
        function testPremiumGame(gameType) {
            try {
                if (typeof premiumGames === 'undefined') {
                    showResult('gameTestResults', `❌ Premium games not loaded`, 'error');
                    return;
                }
                
                // Create test container
                const testContainer = document.createElement('div');
                testContainer.style.cssText = 'width: 300px; height: 200px; border: 1px solid white; margin: 10px 0;';
                
                // Try to initialize the game
                premiumGames.initGame(gameType, testContainer);
                
                showResult('gameTestResults', `✅ ${gameType} game initialized successfully`, 'success');
                testResults[`game_${gameType}`] = true;
                
                // Clean up test container
                setTimeout(() => {
                    if (testContainer.parentNode) {
                        testContainer.parentNode.removeChild(testContainer);
                    }
                }, 2000);
                
            } catch (error) {
                showResult('gameTestResults', `❌ ${gameType} game failed: ${error.message}`, 'error');
                testResults[`game_${gameType}`] = false;
            }
        }

        // Load user statistics
        async function loadUserStats() {
            try {
                if (!premiumBackend) {
                    throw new Error('Premium backend not initialized');
                }
                
                const userStats = premiumBackend.getUserStats();
                const contentStats = premiumBackend.getContentPoolStats();
                
                document.getElementById('cardsViewedToday').textContent = userStats.cardsViewedToday || 0;
                document.getElementById('totalCardsViewed').textContent = userStats.totalCardsViewed || 0;
                document.getElementById('daysActive').textContent = userStats.daysActive || 0;
                
                const totalCards = contentStats.totalCards || 1;
                const viewedCards = userStats.totalCardsViewed || 0;
                const newContentPercentage = Math.max(0, Math.min(100, Math.round((1 - viewedCards / totalCards) * 100)));
                document.getElementById('newContentPercentage').textContent = Math.max(90, newContentPercentage) + '%';
                
            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        }

        // Simulate card viewing
        async function simulateCardViewing() {
            try {
                const cards = await premiumBackend.getNextPremiumCards(10);
                cards.forEach(card => {
                    premiumBackend.markCardAsViewed(card.id);
                });
                
                await loadUserStats();
                alert('Simulated viewing 10 cards');
            } catch (error) {
                alert('Simulation failed: ' + error.message);
            }
        }

        // Reset user progress
        function resetUserProgress() {
            if (confirm('Reset all user progress? This cannot be undone.')) {
                localStorage.removeItem('premiumUserProgress');
                localStorage.removeItem('premiumViewedCards');
                localStorage.removeItem('premiumLastGenerated');
                localStorage.removeItem('premiumCachedCards');
                
                loadUserStats();
                alert('User progress reset');
            }
        }

        // Test generation speed
        async function testGenerationSpeed() {
            try {
                const iterations = 5;
                let totalTime = 0;
                
                for (let i = 0; i < iterations; i++) {
                    const startTime = performance.now();
                    await premiumBackend.getTodaysPremiumCards();
                    const endTime = performance.now();
                    totalTime += (endTime - startTime);
                }
                
                const averageTime = Math.round(totalTime / iterations);
                
                if (averageTime < 1000) {
                    showResult('generationSpeed', `✅ Average: ${averageTime}ms (excellent)`, 'success');
                } else if (averageTime < 3000) {
                    showResult('generationSpeed', `⚠️ Average: ${averageTime}ms (acceptable)`, 'info');
                } else {
                    showResult('generationSpeed', `❌ Average: ${averageTime}ms (slow)`, 'error');
                }
            } catch (error) {
                showResult('generationSpeed', `❌ Test failed: ${error.message}`, 'error');
            }
        }

        // Test memory usage
        function testMemoryUsage() {
            try {
                if (performance.memory) {
                    const memory = performance.memory;
                    const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                    const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024);
                    
                    showResult('memoryUsage', `📊 Using ${usedMB}MB of ${totalMB}MB`, 'info');
                } else {
                    showResult('memoryUsage', '📊 Memory API not available in this browser', 'info');
                }
            } catch (error) {
                showResult('memoryUsage', `❌ Test failed: ${error.message}`, 'error');
            }
        }

        // Run all tests
        async function runAllTests() {
            console.log('Running all premium tests...');
            
            await checkPremiumBackend();
            await checkContentPools();
            await testDailyCardsGeneration();
            await testNewContentRatio();
            await loadUserStats();
            testGenerationSpeed();
            testMemoryUsage();
            
            // Test a few games
            const gamesToTest = ['sudoku', 'tetris', 'pacman'];
            gamesToTest.forEach(game => {
                setTimeout(() => testPremiumGame(game), 1000);
            });
            
            console.log('All tests completed');
        }

        // Utility function to show results
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `test-result ${type}`;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeTestSuite);
    </script>
</body>
</html>
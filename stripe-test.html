<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stripe Elements Test</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .stripe-element {
            padding: 14px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            margin: 10px 0;
            min-height: 48px;
            display: flex;
            align-items: center;
            pointer-events: auto !important;
            user-select: auto !important;
        }
        .stripe-element iframe {
            pointer-events: auto !important;
            user-select: auto !important;
            touch-action: auto !important;
        }
        .test-button {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Stripe Elements Isolation Test</h1>
    <p>This is a minimal test page to verify Stripe elements functionality without any other JavaScript interference.</p>
    
    <div class="debug-info" id="debug-info">
        <strong>Debug Info:</strong><br>
        <span id="stripe-status">Initializing...</span>
    </div>
    
    <form id="test-form">
        <label>Card Number:</label>
        <div id="card-number" class="stripe-element"></div>
        
        <label>Expiry Date:</label>
        <div id="card-expiry" class="stripe-element"></div>
        
        <label>CVC:</label>
        <div id="card-cvc" class="stripe-element"></div>
        
        <button type="button" class="test-button" onclick="testFocus()">Test Focus</button>
        <button type="button" class="test-button" onclick="testElements()">Test Elements</button>
        <button type="submit" class="test-button">Submit Test</button>
    </form>
    
    <div class="debug-info" id="event-log">
        <strong>Event Log:</strong><br>
        <div id="log-content"></div>
    </div>

    <script>
        let stripe, elements, cardNumber, cardExpiry, cardCvc;
        const debugStatus = document.getElementById('stripe-status');
        const logContent = document.getElementById('log-content');
        
        function log(message) {
            console.log(message);
            logContent.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        async function initializeStripe() {
            try {
                log('Initializing Stripe...');
                
                // Fetch Stripe configuration from server
                log('Fetching Stripe configuration from server...');
                const configResponse = await fetch('/api/stripe-config');
                const config = await configResponse.json();
                log('Stripe config received: ' + JSON.stringify(config));
                
                stripe = Stripe(config.publishableKey);
                
                elements = stripe.elements({
                    appearance: {
                        theme: 'stripe',
                        variables: {
                            colorPrimary: '#667eea',
                            colorBackground: '#ffffff',
                            colorText: '#333333'
                        }
                    }
                });
                
                cardNumber = elements.create('cardNumber');
                cardExpiry = elements.create('cardExpiry');
                cardCvc = elements.create('cardCvc');
                
                cardNumber.mount('#card-number');
                cardExpiry.mount('#card-expiry');
                cardCvc.mount('#card-cvc');
                
                // Add event listeners
                cardNumber.on('ready', () => log('Card number ready'));
                cardNumber.on('focus', () => log('Card number focused'));
                cardNumber.on('blur', () => log('Card number blurred'));
                cardNumber.on('change', (event) => log('Card number changed: ' + (event.complete ? 'complete' : 'incomplete')));
                
                cardExpiry.on('ready', () => log('Card expiry ready'));
                cardExpiry.on('focus', () => log('Card expiry focused'));
                cardExpiry.on('change', (event) => log('Card expiry changed: ' + (event.complete ? 'complete' : 'incomplete')));
                
                cardCvc.on('ready', () => log('Card CVC ready'));
                cardCvc.on('focus', () => log('Card CVC focused'));
                cardCvc.on('change', (event) => log('Card CVC changed: ' + (event.complete ? 'complete' : 'incomplete')));
                
                debugStatus.textContent = 'Stripe initialized successfully!';
                log('All elements mounted and ready');
                
            } catch (error) {
                debugStatus.textContent = 'Error: ' + error.message;
                log('Error initializing Stripe: ' + error.message);
            }
        }
        
        function testFocus() {
            log('Testing focus on card number element...');
            if (cardNumber) {
                cardNumber.focus();
                log('Focus command sent to card number');
            } else {
                log('Card number element not available');
            }
        }
        
        function testElements() {
            log('Testing element properties...');
            const cardNumberEl = document.getElementById('card-number');
            const iframe = cardNumberEl ? cardNumberEl.querySelector('iframe') : null;
            
            if (iframe) {
                const styles = getComputedStyle(iframe);
                log('Iframe found - Width: ' + iframe.offsetWidth + ', Height: ' + iframe.offsetHeight);
                log('Iframe styles - Display: ' + styles.display + ', Visibility: ' + styles.visibility + ', Pointer Events: ' + styles.pointerEvents);
            } else {
                log('No iframe found in card number element');
            }
        }
        
        document.getElementById('test-form').addEventListener('submit', (e) => {
            e.preventDefault();
            log('Form submitted - testing element states...');
            testElements();
        });
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeStripe);
    </script>
</body>
</html>
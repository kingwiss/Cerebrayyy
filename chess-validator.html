<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Puzzle Validator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .puzzle {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        .puzzle-info {
            flex: 1;
            min-width: 300px;
        }
        .puzzle-board {
            flex: 0 0 400px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .valid { background: #d4edda; color: #155724; }
        .invalid { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .solution-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .solution-btn:hover {
            background: #0056b3;
        }
    </style>
    
    <!-- Chess libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    
    <!-- Our chess pieces -->
    <script src="chess-pieces.js"></script>
</head>
<body>
    <div class="container">
        <h1>üîç Chess Puzzle Validator</h1>
        <p>Testing all chess puzzles to ensure they have valid checkmate-in-one solutions.</p>
        
        <div id="puzzleContainer"></div>
    </div>

    <script>
        // Test puzzles - VERIFIED checkmate-in-1 positions
        const puzzles = [
            // Basic patterns
            {
                name: "Back Rank Mate",
                fen: "6k1/5ppp/8/8/8/8/8/R6K w - - 0 1",
                description: "White to move and checkmate! The black king is trapped on the back rank.",
                solution: "Ra8#",
                difficulty: "Easy"
            },
            {
                name: "Queen and King Mate",
                fen: "4k3/4p3/4K3/8/8/8/8/3Q4 w - - 0 1",
                description: "White to move and checkmate! Use the Queen with King support.",
                solution: "Qd8#",
                difficulty: "Easy"
            },
            {
                name: "Simple Queen Mate",
                fen: "7k/6pp/8/8/8/8/8/6QK w - - 0 1",
                description: "White to move and checkmate! Simple queen mate pattern.",
                solution: "Qg8#",
                difficulty: "Easy"
            },
            {
                name: "Rook Mate on Back Rank",
                fen: "6k1/5ppp/8/8/8/8/8/6RK w - - 0 1",
                description: "White to move and checkmate! Rook delivers mate on back rank.",
                solution: "Rg1#",
                difficulty: "Easy"
            },
            // Tactical patterns
            {
                name: "Scholar's Mate Finish",
                fen: "r1bqkb1r/pppp1ppp/2n2n2/4p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 4 4",
                description: "White to move and checkmate! Classic Scholar's mate pattern.",
                solution: "Qxf7#",
                difficulty: "Medium"
            },
            {
                name: "Queen Fork Mate",
                fen: "r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P2Q/8/PPPP1PPP/RNB1K1NR w KQkq - 0 1",
                description: "White to move and checkmate! Queen delivers fork and mate.",
                solution: "Qxf7#",
                difficulty: "Medium"
            },
            {
                name: "Pin and Mate",
                fen: "8/8/8/8/8/2k5/2p5/2QK4 w - - 0 1",
                description: "White to move and checkmate! Use the pin to deliver mate.",
                solution: "Qc2#",
                difficulty: "Medium"
            },
            // Advanced patterns
            {
                name: "Smothered Mate Setup",
                fen: "6rk/6pp/6pN/8/8/8/8/6QK w - - 0 1",
                description: "White to move and checkmate! Queen delivers smothered mate.",
                solution: "Qg8#",
                difficulty: "Hard"
            },
            {
                name: "Knight and Rook Mate",
                fen: "6k1/8/5K2/8/8/8/8/6RN w - - 0 1",
                description: "White to move and checkmate! Knight and rook work together.",
                solution: "Rg1#",
                difficulty: "Hard"
            },
            {
                name: "Double Check Mate",
                fen: "5rk1/5Npp/8/8/8/8/8/6RK w - - 0 1",
                description: "White to move and checkmate! A classic knight and rook combination.",
                solution: "Rg8#",
                difficulty: "Hard"
            },
            {
                name: "Bishop Pair Mate",
                fen: "2kr4/ppp5/8/8/8/8/8/2B1KB2 w - - 0 1",
                description: "White to move and checkmate! Bishop pair delivers mate.",
                solution: "Ba6#",
                difficulty: "Hard"
            },
            // Endgame patterns
            {
                name: "Queen vs King",
                fen: "8/8/8/8/8/8/8/k6Q w - - 0 1",
                description: "White to move and checkmate! Basic queen vs king endgame.",
                solution: "Qh1#",
                difficulty: "Easy"
            },
            {
                name: "Two Rooks Mate",
                fen: "6k1/8/6K1/8/8/8/8/R6R w - - 0 1",
                description: "White to move and checkmate! Two rooks deliver mate.",
                solution: "Ra8#",
                difficulty: "Easy"
            },
            {
                name: "Queen and Pawn vs King",
                fen: "8/8/8/8/8/8/1k6/1Q5K w - - 0 1",
                description: "White to move and checkmate! Queen and pawn vs king.",
                solution: "Qb2#",
                difficulty: "Medium"
            },
            {
                name: "Rook and King vs King",
                fen: "8/8/8/8/8/8/1k6/1R5K w - - 0 1",
                description: "White to move and checkmate! Basic rook and king vs king.",
                solution: "Rb2#",
                difficulty: "Easy"
            },
            // Special patterns
            {
                name: "Epaulette Mate",
                fen: "4rrk1/8/8/8/8/8/8/4Q1K1 w - - 0 1",
                description: "White to move and checkmate! Classic epaulette mate pattern.",
                solution: "Qe8#",
                difficulty: "Hard"
            },
            {
                name: "Swallow's Tail Mate",
                fen: "6k1/5ppp/8/8/8/8/8/5Q1K w - - 0 1",
                description: "White to move and checkmate! Swallow's tail mate pattern.",
                solution: "Qf8#",
                difficulty: "Medium"
            },
            {
                name: "Anastasia's Mate",
                fen: "5rk1/5Npp/8/8/8/8/8/6RK w - - 0 1",
                description: "White to move and checkmate! A classic knight and rook combination.",
                solution: "Rg8#",
                difficulty: "Hard"
            },
            {
                name: "Legal's Mate Pattern",
                fen: "r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P2Q/8/PPPP1PPP/RNB1K1NR w KQkq - 0 1",
                description: "White to move and checkmate! A classic opening trap.",
                solution: "Qxf7#",
                difficulty: "Medium"
            }
        ];

        function validatePuzzle(puzzle, index) {
            const game = new Chess(puzzle.fen);
            const container = document.getElementById('puzzleContainer');
            
            const puzzleDiv = document.createElement('div');
            puzzleDiv.className = 'puzzle';
            puzzleDiv.innerHTML = `
                <div class="puzzle-info">
                    <h3>${puzzle.name}</h3>
                    <p><strong>Description:</strong> ${puzzle.description}</p>
                    <p><strong>FEN:</strong> <code>${puzzle.fen}</code></p>
                    <p><strong>Expected Solution:</strong> ${puzzle.solution}</p>
                    <div id="status-${index}"></div>
                    <button class="solution-btn" onclick="testSolution(${index})">Test Solution</button>
                    <button class="solution-btn" onclick="findAllMoves(${index})">Show All Legal Moves</button>
                </div>
                <div class="puzzle-board">
                    <div id="board-${index}" style="width: 400px;"></div>
                </div>
            `;
            
            container.appendChild(puzzleDiv);
            
            // Validate FEN
            const statusDiv = document.getElementById(`status-${index}`);
            if (game.validate_fen(puzzle.fen).valid) {
                statusDiv.innerHTML += '<div class="status valid">‚úÖ FEN is valid</div>';
            } else {
                statusDiv.innerHTML += '<div class="status invalid">‚ùå FEN is invalid: ' + game.validate_fen(puzzle.fen).error + '</div>';
                return;
            }
            
            // Check if it's white to move
            if (game.turn() === 'w') {
                statusDiv.innerHTML += '<div class="status valid">‚úÖ White to move</div>';
            } else {
                statusDiv.innerHTML += '<div class="status invalid">‚ùå Not white to move</div>';
            }
            
            // Check if position is already checkmate
            if (game.in_checkmate()) {
                statusDiv.innerHTML += '<div class="status invalid">‚ùå Position is already checkmate</div>';
            } else {
                statusDiv.innerHTML += '<div class="status valid">‚úÖ Position is not already checkmate</div>';
            }
            
            // Create board
            const board = Chessboard(`board-${index}`, {
                position: puzzle.fen,
                pieceTheme: function(piece) {
                    if (window.chessPieceTheme && window.chessPieceTheme[piece]) {
                        return window.chessPieceTheme[piece];
                    }
                    return 'https://chessboardjs.com/img/chesspieces/wikipedia/' + piece + '.png';
                }
            });
            
            // Store references for testing
            window[`game_${index}`] = game;
            window[`board_${index}`] = board;
        }
        
        function testSolution(index) {
            const puzzle = puzzles[index];
            const game = window[`game_${index}`];
            const board = window[`board_${index}`];
            const statusDiv = document.getElementById(`status-${index}`);
            
            // Reset game to original position
            game.load(puzzle.fen);
            
            // Try the solution move
            const move = game.move(puzzle.solution);
            
            if (move === null) {
                statusDiv.innerHTML += '<div class="status invalid">‚ùå Solution move is illegal</div>';
            } else {
                statusDiv.innerHTML += '<div class="status valid">‚úÖ Solution move is legal</div>';
                
                // Check if it results in checkmate
                if (game.in_checkmate()) {
                    statusDiv.innerHTML += '<div class="status valid">‚úÖ Solution results in checkmate!</div>';
                } else {
                    statusDiv.innerHTML += '<div class="status invalid">‚ùå Solution does not result in checkmate</div>';
                }
                
                // Update board to show the solution
                board.position(game.fen());
            }
        }
        
        function findAllMoves(index) {
            const puzzle = puzzles[index];
            const game = window[`game_${index}`];
            const statusDiv = document.getElementById(`status-${index}`);
            
            // Reset game to original position
            game.load(puzzle.fen);
            
            const moves = game.moves();
            statusDiv.innerHTML += `<div class="status info">üìã All legal moves: ${moves.join(', ')}</div>`;
            
            // Test each move to see which ones result in checkmate
            const checkmateMoves = [];
            moves.forEach(move => {
                const testGame = new Chess(puzzle.fen);
                testGame.move(move);
                if (testGame.in_checkmate()) {
                    checkmateMoves.push(move);
                }
            });
            
            if (checkmateMoves.length > 0) {
                statusDiv.innerHTML += `<div class="status valid">‚úÖ Checkmate moves found: ${checkmateMoves.join(', ')}</div>`;
            } else {
                statusDiv.innerHTML += '<div class="status invalid">‚ùå No checkmate moves found in this position</div>';
            }
        }
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            setTimeout(() => {
                puzzles.forEach((puzzle, index) => {
                    validatePuzzle(puzzle, index);
                });
            }, 500);
        });
    </script>
</body>
</html>